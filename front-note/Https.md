# HTTPS

- HTTPS的非对称加密和对称加密的设计，源于两个方面：安全和效率。非对称加密虽然安全，但是效率不高，因为非对称加密算法的计算量比较大。
- 要真正深入了解HTTPS的，首先不能遗漏的知识点那就是对称加密算法和非对称加密算法了。本片文章会首先简单介绍对称加密算法和非对称加密算法。然后详细分析Https协议从发送请求到浏览器收到响应的整个过程。
- 关键词: 证书、非对称加密算法加密秘钥、对称加密算法加密传输的具体内容

## 与传统的http算法对比

Https=Http+加密+认证+完整性验证

## 加密

加密算法SSL握手的过程：

1. 客户端首先发送给服务器，支持的加密算法、压缩方式、SSL的版本，并生成第一个随机数，以及一个文本内容“hello”
2. 服务器接收到消息，回发文本消息“hello”，并携带从客户端支持的加密方式中选择的加密算法、生成的第二个随机数、服务器的SSL版本号
3. 服务器端发送Certificate报文，报文中包含服务端的公钥证书
4. 服务器端发送消息作为 协商握手结束。
5. 客户端收到握手结束的消息，生成Pre-master secret的随机密码串，用公钥加密后，并伴随Client Key  Exchange报文作为回应，发送给客户端。并生成了master secret。
6. 客户端客户端发送Change Cipher Spec报文，该报文告知服务端使用master secret进行加密
7. 客户端发送Finish报文，此报文中包含连接至今所有报文的整体校验值，用于完整性验证；
8. 服务端响应Change Cipher Spec报文
9. 服务端响应Finish报文，表示完整性校验通过，SSL结束。
10. 以后所有的消息都通过 master secret进行对称加密后传输。

## 秘钥生成

由客户端和服务器端各生成的随机数，加上客户端生成的随机密码序列pre_masster_secret共同生成。使用MD5的生成规则。

## 完整性

第7步中提到的所有的报文是如何校验的？
首先服务端将数字签名通过报文发送给客户器端，客户器端通过约定好的hash算法得到固定长度的hash值，并使用秘钥加密后得到数字签名，然后与接收到的数字签名进行比较，如果相同，则说明报文具有完整性。

